<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>漢字（二年生）筆順 学習プリント</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding-bottom: 30px; }
  h1 { margin: 18px 0 8px; font-size: 1.9rem; color: #2e7d32; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
  .kanji-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px; max-width: 520px; width: 95%; margin: 8px auto; }
  .kanji-grid .cell { background: #fff; border: 2px solid #ddd; border-radius: 8px; text-align: center; font-size: 1.1rem; padding: 5px 0; cursor: pointer; transition: all .2s; user-select: none; }
  .kanji-grid .cell:hover { background: #e8f5e9; transform: scale(1.05); }
  .kanji-grid .cell.active { background: #c8e6c9; border-color: #2e7d32; font-weight: bold; }
  .mode-tabs { display: flex; gap: 4px; margin: 10px 0 6px; }
  .mode-tab { padding: 6px 16px; border: 2px solid #2e7d32; border-radius: 20px; background: #fff; color: #2e7d32; cursor: pointer; font-size: .9rem; font-family: inherit; transition: all .2s; }
  .mode-tab.active { background: #2e7d32; color: #fff; }
  #learnArea { width: 95%; max-width: 900px; margin: 0 auto; }
  .stroke-section { display: flex; flex-wrap: wrap; gap: 16px; justify-content: center; align-items: stretch; margin-bottom: 16px; }
  .big-char-panel { background: #fff; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 16px; text-align: center; width: 280px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .big-char-panel .reading { font-size: 2.2rem; color: #888; margin-bottom: 0; }
  .big-char-panel .big-char { font-size: 10rem; line-height: 1; color: #333; }
  .big-char-panel .stroke-count { font-size: 1rem; color: #2e7d32; margin-top: 4px; font-weight: bold; }
  .stroke-order-panel { background: #fff; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 16px; text-align: center; flex: 1; min-width: 300px; max-width: 580px; }
  .stroke-order-panel h2 { font-size: 1.05rem; color: #555; margin-bottom: 8px; }
  .nazorigaki-img-wrap { margin: 8px auto; border: 2px solid #ccc; border-radius: 10px; overflow: hidden; background: #fafafa; position: relative; cursor: crosshair; }
  .nazorigaki-img-wrap img { display: block; width: 100%; height: auto; max-width: 100%; }
  .nazorigaki-img-wrap canvas { position: absolute; top: 0; left: 0; pointer-events: auto; touch-action: none; }
  .btn-clear { background: #f44336; color: #fff; margin-top: 8px; }
  .btn-clear:hover { background: #c62828; }
  .btn-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; margin-top: 8px; }
  .btn { padding: 7px 16px; border: none; border-radius: 8px; font-size: .95rem; cursor: pointer; transition: all .2s; font-family: inherit; }
  .btn-prev { background: #2196f3; color: #fff; }
  .btn-prev:hover { background: #1565c0; }
  .btn-next { background: #2e7d32; color: #fff; }
  .btn-next:hover { background: #1b5e20; }
  .quiz-panel { background: #fff; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; text-align: center; width: 95%; max-width: 500px; display: none; }
  .quiz-panel h2 { font-size: 1.3rem; color: #555; margin-bottom: 12px; }
  .quiz-question { font-size: 5rem; color: #333; margin: 10px 0; }
  .quiz-choices { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 16px auto; max-width: 360px; }
  .quiz-choice { padding: 14px; border: 2px solid #ddd; border-radius: 12px; font-size: 1.2rem; cursor: pointer; transition: all .2s; background: #fafafa; font-family: inherit; }
  .quiz-choice:hover { border-color: #2e7d32; background: #e8f5e9; }
  .quiz-choice.correct { background: #c8e6c9; border-color: #4caf50; }
  .quiz-choice.wrong { background: #ffcdd2; border-color: #f44336; }
  .quiz-score { font-size: 1.1rem; color: #666; margin: 10px 0; }
  .quiz-feedback { font-size: 1.2rem; min-height: 1.5em; margin: 8px 0; }
  footer { margin: 20px 0; color: #999; font-size: .8rem; }
  @media (max-width: 640px) { .kanji-grid { grid-template-columns: repeat(8, 1fr); } .stroke-section { flex-direction: column; align-items: center; } .big-char-panel { width: 95%; } .stroke-order-panel { min-width: auto; width: 95%; } }
</style>
</head>
<body>
<h1>漢字（二年生）</h1>
<div class="mode-tabs">
  <button class="mode-tab active" onclick="setMode('learn')">学習モード</button>
  <button class="mode-tab" onclick="setMode('quiz')">クイズモード</button>
</div>
<div class="kanji-grid" id="kanjiGrid"></div>
<div id="learnArea">
  <div class="stroke-section">
    <div class="big-char-panel">
      <p class="reading" id="readingDisplay">-</p>
      <p class="big-char" id="charDisplay">-</p>
      <p class="stroke-count" id="strokeCount">-画</p>
      <div class="btn-row" style="margin-top:10px;">
        <button class="btn btn-prev" onclick="prevChar()">◀ 前</button>
        <button class="btn btn-next" onclick="nextChar()">次 ▶</button>
      </div>
    </div>
    <div class="stroke-order-panel">
      <h2>ひつじゅん・れんしゅう（なぞりがき）</h2>
      <p style="font-size:.85rem;color:#777;margin-bottom:8px;">© <a href="https://kakijun.com/" target="_blank" rel="noopener">漢字書き順辞典</a> 筆順画像を使用</p>
      <div class="nazorigaki-img-wrap" id="nazorigakiWrap">
        <img id="nazorigakiImg" src="" alt="ひつじゅん・れんしゅう" />
        <canvas id="nazorigakiCanvas"></canvas>
      </div>
      <div class="btn-row">
        <button class="btn btn-clear" onclick="clearNazorigakiCanvas()">けす</button>
      </div>
    </div>
  </div>
</div>
<div class="quiz-panel" id="quizArea">
  <h2>漢字（二年生）クイズ</h2>
  <p class="quiz-score" id="quizScore">正解: 0 / 0</p>
  <p class="quiz-question" id="quizQuestion">-</p>
  <p class="quiz-feedback" id="quizFeedback">&nbsp;</p>
  <div class="quiz-choices" id="quizChoices"></div>
  <div class="btn-row" style="margin-top:14px;">
    <button class="btn btn-next" id="btnNextQuiz" onclick="nextQuiz()" style="display:none;">次の問題 ▶</button>
  </div>
</div>
<footer>漢字（二年生） 学習プリント ― © <a href="https://kakijun.com/" target="_blank" rel="noopener" style="color:#999;">漢字書き順辞典</a></footer>
<script>
const KANJI = [
  {ch:'刀',reading:'かたな・とう',unicode:'5200',strokes:2},
  {ch:'丸',reading:'まる・がん',unicode:'4e38',strokes:3},
  {ch:'弓',reading:'ゆみ・きゅう',unicode:'5f13',strokes:3},
  {ch:'工',reading:'こう',unicode:'5de5',strokes:3},
  {ch:'才',reading:'さい',unicode:'624d',strokes:3},
  {ch:'万',reading:'よろず・まん',unicode:'4e07',strokes:3},
  {ch:'引',reading:'ひ・いん',unicode:'5f15',strokes:4},
  {ch:'牛',reading:'うし・ぎゅう',unicode:'725b',strokes:4},
  {ch:'今',reading:'いま・こん',unicode:'4eca',strokes:4},
  {ch:'元',reading:'もと・げん',unicode:'5143',strokes:4},
  {ch:'戸',reading:'と・こ',unicode:'6238',strokes:4},
  {ch:'午',reading:'うま・ご',unicode:'5348',strokes:4},
  {ch:'公',reading:'おおやけ・こう',unicode:'516c',strokes:4},
  {ch:'止',reading:'と・し',unicode:'6b62',strokes:4},
  {ch:'少',reading:'すく・しょう',unicode:'5c11',strokes:4},
  {ch:'心',reading:'こころ・しん',unicode:'5fc3',strokes:4},
  {ch:'切',reading:'き・せつ',unicode:'5207',strokes:4},
  {ch:'太',reading:'ふと・たい',unicode:'592a',strokes:4},
  {ch:'内',reading:'うち・ない',unicode:'5185',strokes:4},
  {ch:'父',reading:'ちち・ふ',unicode:'7236',strokes:4},
  {ch:'分',reading:'わ・ぶん',unicode:'5206',strokes:4},
  {ch:'方',reading:'かた・ほう',unicode:'65b9',strokes:4},
  {ch:'毛',reading:'け・もう',unicode:'6bdb',strokes:4},
  {ch:'友',reading:'とも・ゆう',unicode:'53cb',strokes:4},
  {ch:'外',reading:'そと・がい',unicode:'5916',strokes:5},
  {ch:'兄',reading:'あに・けい',unicode:'5144',strokes:5},
  {ch:'古',reading:'ふる・こ',unicode:'53e4',strokes:5},
  {ch:'広',reading:'ひろ・こう',unicode:'5e83',strokes:5},
  {ch:'矢',reading:'や・し',unicode:'77e2',strokes:5},
  {ch:'市',reading:'いち・し',unicode:'5e02',strokes:5},
  {ch:'台',reading:'うてな・だい',unicode:'53f0',strokes:5},
  {ch:'冬',reading:'ふゆ・とう',unicode:'51ac',strokes:5},
  {ch:'半',reading:'なか・はん',unicode:'534a',strokes:5},
  {ch:'母',reading:'はは・ぼ',unicode:'6bcd',strokes:5},
  {ch:'北',reading:'きた・ほく',unicode:'5317',strokes:5},
  {ch:'用',reading:'もち・よう',unicode:'7528',strokes:5},
  {ch:'羽',reading:'は・う',unicode:'7fbd',strokes:6},
  {ch:'会',reading:'あ・かい',unicode:'4f1a',strokes:6},
  {ch:'回',reading:'まわ・かい',unicode:'56de',strokes:6},
  {ch:'交',reading:'まじ・こう',unicode:'4ea4',strokes:6},
  {ch:'光',reading:'ひか・こう',unicode:'5149',strokes:6},
  {ch:'考',reading:'かんが・こう',unicode:'8003',strokes:6},
  {ch:'行',reading:'い・こう',unicode:'884c',strokes:6},
  {ch:'合',reading:'あ・ごう',unicode:'5408',strokes:6},
  {ch:'寺',reading:'てら・じ',unicode:'5bfa',strokes:6},
  {ch:'自',reading:'みずか・じ',unicode:'81ea',strokes:6},
  {ch:'色',reading:'いろ・しょく',unicode:'8272',strokes:6},
  {ch:'西',reading:'にし・せい',unicode:'897f',strokes:6},
  {ch:'多',reading:'おお・た',unicode:'591a',strokes:6},
  {ch:'池',reading:'いけ・ち',unicode:'6c60',strokes:6},
  {ch:'地',reading:'ち',unicode:'5730',strokes:6},
  {ch:'当',reading:'あ・とう',unicode:'5f53',strokes:6},
  {ch:'同',reading:'おな・どう',unicode:'540c',strokes:6},
  {ch:'肉',reading:'しし・にく',unicode:'8089',strokes:6},
  {ch:'米',reading:'こめ・べい',unicode:'7c73',strokes:6},
  {ch:'毎',reading:'ごと・まい',unicode:'6bce',strokes:6},
  {ch:'何',reading:'なに・か',unicode:'4f55',strokes:7},
  {ch:'角',reading:'かど・かく',unicode:'89d2',strokes:7},
  {ch:'汽',reading:'き',unicode:'6c7d',strokes:7},
  {ch:'近',reading:'ちか・きん',unicode:'8fd1',strokes:7},
  {ch:'形',reading:'かた・けい',unicode:'5f62',strokes:7},
  {ch:'言',reading:'い・げん',unicode:'8a00',strokes:7},
  {ch:'谷',reading:'たに・こく',unicode:'8c37',strokes:7},
  {ch:'作',reading:'つく・さく',unicode:'4f5c',strokes:7},
  {ch:'社',reading:'やしろ・しゃ',unicode:'793e',strokes:7},
  {ch:'図',reading:'え・ず',unicode:'56f3',strokes:7},
  {ch:'声',reading:'こえ・せい',unicode:'58f0',strokes:7},
  {ch:'走',reading:'はし・そう',unicode:'8d70',strokes:7},
  {ch:'体',reading:'からだ・たい',unicode:'4f53',strokes:7},
  {ch:'弟',reading:'おとうと・てい',unicode:'5f1f',strokes:7},
  {ch:'売',reading:'う・ばい',unicode:'58f2',strokes:7},
  {ch:'麦',reading:'むぎ・ばく',unicode:'9ea6',strokes:7},
  {ch:'来',reading:'く・らい',unicode:'6765',strokes:7},
  {ch:'里',reading:'さと・り',unicode:'91cc',strokes:7},
  {ch:'画',reading:'えが・が',unicode:'753b',strokes:8},
  {ch:'岩',reading:'いわ・がん',unicode:'5ca9',strokes:8},
  {ch:'京',reading:'みやこ・きょう',unicode:'4eac',strokes:8},
  {ch:'国',reading:'くに・こく',unicode:'56fd',strokes:8},
  {ch:'姉',reading:'あね・し',unicode:'59c9',strokes:8},
  {ch:'知',reading:'し・ち',unicode:'77e5',strokes:8},
  {ch:'長',reading:'なが・ちょう',unicode:'9577',strokes:8},
  {ch:'直',reading:'ただ・ちょく',unicode:'76f4',strokes:8},
  {ch:'店',reading:'みせ・てん',unicode:'5e97',strokes:8},
  {ch:'東',reading:'ひがし・とう',unicode:'6771',strokes:8},
  {ch:'歩',reading:'ある・ほ',unicode:'6b69',strokes:8},
  {ch:'妹',reading:'いもうと・まい',unicode:'59b9',strokes:8},
  {ch:'明',reading:'あ・めい',unicode:'660e',strokes:8},
  {ch:'門',reading:'かど・もん',unicode:'9580',strokes:8},
  {ch:'夜',reading:'よ・や',unicode:'591c',strokes:8},
  {ch:'科',reading:'か',unicode:'79d1',strokes:9},
  {ch:'海',reading:'うみ・かい',unicode:'6d77',strokes:9},
  {ch:'活',reading:'い・かつ',unicode:'6d3b',strokes:9},
  {ch:'計',reading:'はか・けい',unicode:'8a08',strokes:9},
  {ch:'後',reading:'のち・ご',unicode:'5f8c',strokes:9},
  {ch:'室',reading:'むろ・しつ',unicode:'5ba4',strokes:9},
  {ch:'首',reading:'くび・しゅ',unicode:'9996',strokes:9},
  {ch:'秋',reading:'あき・しゅう',unicode:'79cb',strokes:9},
  {ch:'春',reading:'はる・しゅん',unicode:'6625',strokes:9},
  {ch:'食',reading:'く・しょく',unicode:'98df',strokes:9},
  {ch:'星',reading:'ほし・せい',unicode:'661f',strokes:9},
  {ch:'前',reading:'まえ・ぜん',unicode:'524d',strokes:9},
  {ch:'茶',reading:'ちゃ',unicode:'8336',strokes:9},
  {ch:'昼',reading:'ひる・ちゅう',unicode:'663c',strokes:9},
  {ch:'点',reading:'つ・てん',unicode:'70b9',strokes:9},
  {ch:'南',reading:'みなみ・なん',unicode:'5357',strokes:9},
  {ch:'風',reading:'かぜ・ふう',unicode:'98a8',strokes:9},
  {ch:'思',reading:'おも・し',unicode:'601d',strokes:9},
  {ch:'家',reading:'いえ・か',unicode:'5bb6',strokes:10},
  {ch:'夏',reading:'なつ・か',unicode:'590f',strokes:10},
  {ch:'記',reading:'しる・き',unicode:'8a18',strokes:10},
  {ch:'帰',reading:'かえ・き',unicode:'5e30',strokes:10},
  {ch:'原',reading:'はら・げん',unicode:'539f',strokes:10},
  {ch:'高',reading:'たか・こう',unicode:'9ad8',strokes:10},
  {ch:'紙',reading:'かみ・し',unicode:'7d19',strokes:10},
  {ch:'時',reading:'とき・じ',unicode:'6642',strokes:10},
  {ch:'弱',reading:'よわ・じゃく',unicode:'5f31',strokes:10},
  {ch:'書',reading:'か・しょ',unicode:'66f8',strokes:10},
  {ch:'通',reading:'とお・つう',unicode:'901a',strokes:10},
  {ch:'馬',reading:'うま・ば',unicode:'99ac',strokes:10},
  {ch:'魚',reading:'うお・ぎょ',unicode:'9b5a',strokes:11},
  {ch:'教',reading:'おし・きょう',unicode:'6559',strokes:11},
  {ch:'強',reading:'つよ・きょう',unicode:'5f37',strokes:11},
  {ch:'黄',reading:'き・こう',unicode:'9ec4',strokes:11},
  {ch:'黒',reading:'くろ・こく',unicode:'9ed2',strokes:11},
  {ch:'細',reading:'ほそ・さい',unicode:'7d30',strokes:11},
  {ch:'週',reading:'しゅう',unicode:'9031',strokes:11},
  {ch:'雪',reading:'ゆき・せつ',unicode:'96ea',strokes:11},
  {ch:'船',reading:'ふね・せん',unicode:'8239',strokes:11},
  {ch:'組',reading:'く・そ',unicode:'7d44',strokes:11},
  {ch:'鳥',reading:'とり・ちょう',unicode:'9ce5',strokes:11},
  {ch:'野',reading:'の・や',unicode:'91ce',strokes:11},
  {ch:'理',reading:'ことわり・り',unicode:'7406',strokes:11},
  {ch:'雲',reading:'くも・うん',unicode:'96f2',strokes:12},
  {ch:'絵',reading:'かい',unicode:'7d75',strokes:12},
  {ch:'間',reading:'あいだ・かん',unicode:'9593',strokes:12},
  {ch:'場',reading:'ば・じょう',unicode:'5834',strokes:12},
  {ch:'晴',reading:'は・せい',unicode:'6674',strokes:12},
  {ch:'朝',reading:'あさ・ちょう',unicode:'671d',strokes:12},
  {ch:'答',reading:'こた・とう',unicode:'7b54',strokes:12},
  {ch:'道',reading:'みち・どう',unicode:'9053',strokes:12},
  {ch:'買',reading:'か・ばい',unicode:'8cb7',strokes:12},
  {ch:'番',reading:'つが・ばん',unicode:'756a',strokes:12},
  {ch:'遠',reading:'とお・えん',unicode:'9060',strokes:13},
  {ch:'園',reading:'その・えん',unicode:'5712',strokes:13},
  {ch:'楽',reading:'たの・がく',unicode:'697d',strokes:13},
  {ch:'新',reading:'あたら・しん',unicode:'65b0',strokes:13},
  {ch:'数',reading:'かず・すう',unicode:'6570',strokes:13},
  {ch:'電',reading:'でん',unicode:'96fb',strokes:13},
  {ch:'話',reading:'はな・わ',unicode:'8a71',strokes:13},
  {ch:'歌',reading:'うた・か',unicode:'6b4c',strokes:14},
  {ch:'語',reading:'かた・ご',unicode:'8a9e',strokes:14},
  {ch:'算',reading:'そろ・さん',unicode:'7b97',strokes:14},
  {ch:'読',reading:'よ・どく',unicode:'8aad',strokes:14},
  {ch:'聞',reading:'き・ぶん',unicode:'805e',strokes:14},
  {ch:'鳴',reading:'な・めい',unicode:'9cf4',strokes:14},
  {ch:'線',reading:'すじ・せん',unicode:'7dda',strokes:15},
  {ch:'親',reading:'おや・しん',unicode:'89aa',strokes:16},
  {ch:'頭',reading:'あたま・とう',unicode:'982d',strokes:16},
  {ch:'顔',reading:'かお・がん',unicode:'9854',strokes:18},
  {ch:'曜',reading:'よう',unicode:'66dc',strokes:18}
];
let currentIndex = 0; let mode = 'learn'; let quizCorrect = 0, quizTotal = 0, quizAnswered = false;
const KAKIJUN_BASE = 'https://kakijun.com/kanjiphoto/worksheet/1/kanji-kakijun-worksheet-1-';
function buildGrid() { const grid = document.getElementById('kanjiGrid'); grid.innerHTML = ''; KANJI.forEach((k, i) => { const div = document.createElement('div'); div.className = 'cell'; div.textContent = k.ch; div.onclick = () => { currentIndex = i; updateDisplay(); }; grid.appendChild(div); }); }
function highlightGrid() { const ch = KANJI[currentIndex].ch; document.querySelectorAll('.kanji-grid .cell').forEach((c, i) => { c.classList.toggle('active', KANJI[i].ch === ch); }); }
function updateDisplay() { const k = KANJI[currentIndex]; document.getElementById('charDisplay').textContent = k.ch; document.getElementById('readingDisplay').textContent = k.reading; document.getElementById('strokeCount').textContent = k.strokes + '画'; highlightGrid(); const img = document.getElementById('nazorigakiImg'); img.src = KAKIJUN_BASE + k.unicode + '.png'; img.alt = k.ch + ' の書き順'; clearNazorigakiCanvas(); if (img.complete && img.naturalWidth) resizeNazorigakiCanvas(); }
function resizeNazorigakiCanvas() { const canvas = document.getElementById('nazorigakiCanvas'); const wrap = document.getElementById('nazorigakiWrap'); const rect = wrap.getBoundingClientRect(); if (rect.width < 10 || rect.height < 10) return; const dpr = window.devicePixelRatio || 1; const w = Math.round(rect.width * dpr); const h = Math.round(rect.height * dpr); if (canvas.width !== w || canvas.height !== h) { canvas.width = w; canvas.height = h; canvas.style.width = rect.width + 'px'; canvas.style.height = rect.height + 'px'; } }
function clearNazorigakiCanvas() { const canvas = document.getElementById('nazorigakiCanvas'); const ctx = canvas.getContext('2d'); ctx.clearRect(0, 0, canvas.width, canvas.height); }
function setupNazorigakiDrawing() { const canvas = document.getElementById('nazorigakiCanvas'); const ctx = canvas.getContext('2d'); let drawing = false; canvas.addEventListener('pointerdown', e => { drawing = true; ctx.beginPath(); const r = canvas.getBoundingClientRect(); ctx.moveTo((e.clientX-r.left)*canvas.width/r.width, (e.clientY-r.top)*canvas.height/r.height); canvas.setPointerCapture(e.pointerId); }); canvas.addEventListener('pointermove', e => { if (!drawing) return; const r = canvas.getBoundingClientRect(); ctx.lineWidth = 18; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.strokeStyle = '#333'; ctx.lineTo((e.clientX-r.left)*canvas.width/r.width, (e.clientY-r.top)*canvas.height/r.height); ctx.stroke(); }); canvas.addEventListener('pointerup', () => drawing = false); canvas.addEventListener('pointerleave', () => drawing = false); }
function initNazorigakiCanvas() { const img = document.getElementById('nazorigakiImg'); function syncCanvas() { resizeNazorigakiCanvas(); } img.addEventListener('load', syncCanvas); window.addEventListener('resize', syncCanvas); new ResizeObserver(syncCanvas).observe(document.getElementById('nazorigakiWrap')); syncCanvas(); setupNazorigakiDrawing(); }
function prevChar() { currentIndex = (currentIndex - 1 + KANJI.length) % KANJI.length; updateDisplay(); }
function nextChar() { currentIndex = (currentIndex + 1) % KANJI.length; updateDisplay(); }
function setMode(m) { mode = m; document.querySelectorAll('.mode-tab').forEach(t => t.classList.toggle('active', t.textContent.includes(m==='learn'?'学習':'クイズ'))); document.getElementById('learnArea').style.display = m==='learn' ? 'block' : 'none'; document.getElementById('quizArea').style.display = m==='quiz' ? 'block' : 'none'; if (m==='quiz') { quizCorrect=0; quizTotal=0; nextQuiz(); } }
function nextQuiz() { quizAnswered = false; document.getElementById('quizFeedback').innerHTML = '&nbsp;'; document.getElementById('btnNextQuiz').style.display = 'none'; const qi = Math.floor(Math.random()*KANJI.length); const {ch, reading} = KANJI[qi]; const mainReading = reading.split('・')[0]; const type = Math.random() < 0.5 ? 'k2r' : 'r2k'; let question, answer, pool; if (type==='k2r') { question = ch; answer = mainReading; pool = KANJI.map(k => k.reading.split('・')[0]); } else { question = mainReading; answer = ch; pool = KANJI.map(k => k.ch); } const choices = genChoices(answer, pool); document.getElementById('quizQuestion').textContent = question; document.getElementById('quizScore').textContent = `正解: ${quizCorrect} / ${quizTotal}`; const div = document.getElementById('quizChoices'); div.innerHTML = ''; choices.forEach(c => { const btn = document.createElement('button'); btn.className = 'quiz-choice'; btn.textContent = c; btn.onclick = () => checkAnswer(btn, c, answer); div.appendChild(btn); }); }
function genChoices(correct, pool) { const s = new Set([correct]); while (s.size < 4) s.add(pool[Math.floor(Math.random()*pool.length)]); return shuffle([...s]); }
function shuffle(a) { for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]; } return a; }
function checkAnswer(btn, sel, cor) { if (quizAnswered) return; quizAnswered = true; quizTotal++; if (sel===cor) { quizCorrect++; btn.classList.add('correct'); document.getElementById('quizFeedback').textContent='⭕ 正解！'; document.getElementById('quizFeedback').style.color='#4caf50'; } else { btn.classList.add('wrong'); document.getElementById('quizFeedback').textContent=`❌ 不正解… 正解は「${cor}」`; document.getElementById('quizFeedback').style.color='#f44336'; document.querySelectorAll('.quiz-choice').forEach(b=>{ if(b.textContent===cor) b.classList.add('correct'); }); } document.getElementById('quizScore').textContent=`正解: ${quizCorrect} / ${quizTotal}`; document.getElementById('btnNextQuiz').style.display='inline-block'; }
document.addEventListener('keydown', e => { if (mode==='learn') { if (e.key==='ArrowLeft') prevChar(); else if (e.key==='ArrowRight') nextChar(); } });
buildGrid(); updateDisplay(); initNazorigakiCanvas();
</script>
</body>
</html>